import{g as n}from"./BoEBYeq-.js";import{r as _}from"./CR2liGHp.js";import{i as x,c as b,u as g,r as D}from"./DWJ43-ZD.js";import{g as o}from"./C_S5TygX.js";import{A as d,__tla as H}from"./Djyhf4cp.js";import{l as h,a as y,o as K,i as I,h as C,j as $,d as q,g as J,k as Q,s as V,r as Y,m as W,__tla as X}from"./RG-z8tzU.js";import{g as t,u as f}from"./Bvbqq-zN.js";import{a as Z}from"./ClXJh1T-.js";import{p as N}from"./Bg1yBDra.js";import{s as v,a as l,i as k,b as aa}from"./CJxW89IG.js";import{g as ea,a as ta}from"./D7NkiQyh.js";import{g as p}from"./CkIfqAOp.js";import{s as oa,__tla as ia}from"./DqqvuqO8.js";import{U as na}from"./BwH_vxp2.js";let G,U,S,w,L,A,R,P,B,O,ra=Promise.all([(()=>{try{return H}catch{}})(),(()=>{try{return X}catch{}})(),(()=>{try{return ia}catch{}})()]).then(async()=>{let E;U=async()=>{const a=o(v);return{...l?$:q,handleSubmit:async e=>{await w(e.email,e.password,e.phone_number)},...l?{}:{alternativeButtons:[...a!=null&&a.lms_login_enabled?[{label:await t("c_coach"),type:"secondary-outlined-inverted",image:"/images/coach-icon.png",onClick:()=>I()}]:[],{label:await t("c_google"),type:"secondary-outlined-inverted",image:"/images/google-icon.png",onClick:e=>C(e)}]},footer:{text:await t("no_account"),button:{label:await t("signup"),type:"secondary-outlined-inverted",link:a!=null&&a.principal_enabled?"/account/signup":"/account/user/signup"}},forgotPassword:{label:await t("forgot_password"),link:"/account/forgot-password"},role:"login"}},E=()=>k?J:l?Q:V,S=async()=>{const a=o(v);return{...E(),handleSubmit:async e=>{await P(e)},...l?{}:{alternativeButtons:[...a!=null&&a.lms_login_enabled?[{label:await t("c_coach"),type:"secondary-outlined-inverted",image:"/images/coach-icon.png",onClick:()=>I()}]:[],{label:await t("c_google"),type:"secondary-outlined-inverted",image:"/images/google-icon.png",onClick:e=>C(e)}]},footer:{text:await t("already_account"),button:{label:await t("login"),type:"secondary-outlined-inverted",link:"/account/user/login"}},role:"learner"}},O=async()=>({...await S(),footer:{text:await t("already_account"),button:{label:await t("login"),type:"secondary-outlined-inverted",onClick:()=>{y.set({visible:!0,page:"user-login"})}}}}),B=async()=>({...await U(),footer:{text:await t("no_account"),button:{label:await t("signup"),type:"secondary-outlined-inverted",onClick:()=>{y.set({visible:!0,page:"user-selection"})}}}}),G={...W,footer:{text:await t("back_to_login"),button:{label:await t("login"),type:"secondary-outlined-inverted",link:"/account/user/login"}},role:"learner"},R={...Y,footer:{text:await t("back_to_login"),button:{label:await t("login"),type:"secondary-outlined-inverted",link:"/account/user/login"}},role:"learner"},P=async function(a,e="learner",r=!1){const s=o(v),u=window.location.hostname,m=l&&u.includes(s==null?void 0:s.safaricom_domain)?na.Safaricom:void 0,c=D({...a,name:"",profile_picture:(aa?ea().id:ta()).toString(),role:s!=null&&s.principal_enabled?e:"learner",...l&&!r&&{otp_type:1},...m&&{user_type:m}},{email:k?"email":"username",turnstileToken:"t_token"}),i=o(x).instance_id,T=k?d.EMAIL_SIGNUP:l&&!r?d.OTP_SIGNUP:d.SIGNUP_USER,M=c.username||c.phone_number,j=c.password,F=await _(T,c,{headers:{instance_id:i}});F.error_code==0&&(l&&!r?(n("/account/verify-code"),K.update(z=>({...z,phone_number:a.phone_number}))):F.data.origin?n("/account/verify",{state:{data:c}}):await w(M,j))},w=async function(a,e,r){const s=o(x).instance_id,u=o(p).points,m=o(b).url,c=o(p).guest_mode,i=await _(d.LOGIN_USER,{username:a||r,password:e},{headers:{instance_id:s}});i.error_code==0&&i.data.length>0&&(f.set(i.data[0]),g(f,"is_guest_mode",!1),o(y).visible?(y.set({visible:!1,page:""}),u>0&&i.data[0].active_role!="principal"&&await oa({competition_id:o(b).competition_id,grade:o(b).current_grade,points:u}),c?i.data[0].active_role=="principal"?(i.data[0].profile_completion_step?n("/admin/competitions"):n("/account/institution/details"),g(p,"guest_mode",!1)):(n(`/competitions/${m}/home`),g(p,"guest_mode",!1)):(g(p,"guest_mode",!1),n(N.url.pathname)),console.log(N,"pagepage")):i.data[0].active_role=="principal"?i.data[0].profile_completion_step?n("/admin/competitions"):n("/account/institution/details"):n("/competitions"))},L=async function(a){{let e=null;const r=o(f).refresh_token;if(!r)return h(!0);try{e=await _(d.TOKEN_REFRESH,{},{headers:{Authorization:"Bearer "+r},allowFailing:!0})}catch{return h(!0)}e&&e.error_code==0?(f.set(e.data[0]),a()):h(!0)}},A=async function(a){(await _(d.EMAIL_SIGNUP,a)).error_code==0&&Z("Email sent successfully!")}});export{ra as __tla,G as forgotPasswordForm,U as getUserLoginForm,S as getUserSignUpForm,w as loginUser,L as refreshUserToken,A as resendEmail,R as resetPasswordForm,P as signUpUserUsingFormData,B as userLoginFormPopup,O as userSignUpFormPopup};
