import{w as T,g as D}from"./C_S5TygX.js";import{u as q}from"./Bvbqq-zN.js";import{h as O}from"./DWJ43-ZD.js";import{f as P}from"./E8PaDAPB.js";const _="https://devcompetitionapi.knowledgeplatform.com/api/",S="0x4AAAAAAATTI8DjOR9nUgOF",U="993486033665-pvkgktsljun2jmjapsm1kmcpa252j5ef.apps.googleusercontent.com",x="https://qa--kplmsdev.netlify.app/public-login?isBonzo=1&isGlobalGreenGuardians=1",z="https://qa--kplmsdev.netlify.app/",F=_,k=T(new Map),E=new Set,G=2*60*1e3;function B(s){return s&&Date.now()-s.timestamp<G}function j(s,t,i){setTimeout(async()=>{await O(P,"isUILoaded"),window.dispatchEvent(new CustomEvent("apiError",{detail:{message:s,status:t,retryCallback:i}}))},5)}async function I(s,t={},i={}){const{definitionOverrides:d={},allowFailing:p=!1,headers:A={},...b}=i,a={...s,...d},{method:w,endpoint:u,cache:h,secure:$,contentType:C="application/json",loader:g}=a,v=`${u}:${JSON.stringify(t)}`;if(J(a,t),h){let n;if(k.subscribe(r=>{n=r.get(v)})(),n&&B(n))return n.data}g&&window.dispatchEvent(new CustomEvent("loaderStart",{detail:{apiDefinition:a,params:t}}));const m=new AbortController;E.add(m);let o;const y=async()=>{try{const n=`${a.baseURL||F}${u}`,r={...A};if($){const e=L();if(e)r.Authorization=`Bearer ${e}`;else throw{message:"Authentication token is missing",status:401}}let f;if(C==="multipart/form-data"){const e=new FormData;for(const l in t)e.append(l,t[l]);f=e}else r["Content-Type"]="application/json",f=w!=="GET"?JSON.stringify(t):void 0;const c=await fetch(n,{method:w,headers:r,body:f,signal:m.signal,...b});if(!c.ok){const e={status:c.status,message:`${u} request failed with status ${c.status} ${c.statusText}`};if(p)return Promise.reject(e);throw e}if(o=await c.json(),o&&o.error_code&&o.error_code!==0){const e=a==null?void 0:a.errorCodes[o.error_code];e?window.dispatchEvent(new CustomEvent("showErrorToast",{detail:{message:e}})):console.error(o.error_code+" error code is not defined")}h&&k.update(e=>{if(e.size>=20){const l=e.keys().next().value;e.delete(l)}return e.set(v,{data:o,timestamp:Date.now()}),e})}catch(n){return p?Promise.reject(n):new Promise(r=>{j(n.message,n.status||"Unknown",()=>{r(y())})})}finally{E.delete(m),g&&window.dispatchEvent(new CustomEvent("loaderEnd",{detail:{apiDefinition:a,params:t}}))}return o};return y()}function J(s,t){const{requiredParams:i}=s;if(!i)return!0;const d=i.filter(p=>!(p in t));return d.length>0&&j(`Missing required parameters: ${d.join(", ")}`,"400"),!0}function L(){return D(q).auth_token}export{S as P,U as a,x as b,z as c,I as r};
