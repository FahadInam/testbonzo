import{r as _}from"./CR2liGHp.js";import{e as q,u,f as l,c as i,h as L,b as P,j,i as U,v as F}from"./DWJ43-ZD.js";import{g as a}from"./C_S5TygX.js";import{A as s,__tla as G}from"./Djyhf4cp.js";import{u as p,g as d}from"./Bvbqq-zN.js";import{g as z}from"./BoEBYeq-.js";import{I as m}from"./_Vcui5w2.js";import{s as f}from"./ClXJh1T-.js";import{refreshUserToken as B,__tla as Y}from"./3hQXMHQA.js";import{a as Z,s as W}from"./CJxW89IG.js";import{t as x}from"./-67--UVX.js";import{m as J}from"./CuKIkSf6.js";let E,S,I,g,y,A,D,N,O,b,R,T,w,h,H,M,k,v,K=Promise.all([(()=>{try{return G}catch{}})(),(()=>{try{return Y}catch{}})()]).then(async()=>{E=async function(){var o;const e=!a(p).is_guest_mode,t=a(i).is_lesson_page_hide==0,r=a(i).is_games_page==1;return[{icon:m.SIDE_NAV_HOME,label:await d("home"),link:"{competitionHome}/home",isRequired:!0},...((o=a(i))==null?void 0:o.is_games_page)==1&&e?[{icon:m.SIDE_NAV_MY_GAMES,label:await d("my_games"),link:"{competitionHome}/my-games"}]:[],{icon:m.SIDE_NAV_LESSON,label:await d("lessons"),link:"{competitionHome}/lessons"},{icon:m.SIDE_NAV_FRIENDS,label:await d("friends"),link:"{competitionHome}/friends"},{icon:m.SIDE_NAV_LEADERBOARD,label:await d("leaderboard"),link:"{competitionHome}/leaderboard",isRequired:!0},{icon:m.SIDE_NAV_REWARDS,label:await d("rewards"),link:"{competitionHome}/rewards",isRequired:!0}].filter(n=>n.isRequired||n.link==="{competitionHome}/friends"&&e||n.link==="{competitionHome}/lessons"&&t||n.link==="{competitionHome}/my-games"&&r)},S=async function(){await q();const{active_role:e}=a(p),t=e==="principal"?s.INSTITUTION_COMPETITIONS:s.COMPETITIONS,r=await _(t,{});return await C(r),r};async function C(e){const{active_role:t,is_guest_mode:r,timezone:o}=a(p),n=t==="principal";if(!(e.error_code===0&&!n&&!r&&Z&&!o))return;const c=Intl.DateTimeFormat().resolvedOptions().timeZone;(await _(s.UPDATE_TIMEZONE,{timezone:c},{})).error_code===0&&u(p,"timezone",c)}k=async function(){await j();const e=a(U).instance_id;return await _(s.DEMO_COMPETITIONS,{},{headers:{instance_id:e}})},g=async function(){await L(i,"competition_id");const e=a(i).competition_id;return await _(s.COMPETITION_DETAILS,{competition_id:e},{})},T=async function(){const e=await g(),t=w(e.data.grades);P.set({grades:e.data.grades,current_grade:e.data.current_grade}),x.set(t),u(i,"current_grade",e.data.current_grade)},w=function(e){const t=new Set;return e.reduce((r,o)=>(t.has(o.grade)||(t.add(o.grade),r.push({value:o.grade,label:o.grade_alias,sort_order:o.sort_order})),r.some(n=>n.sort_order!==null)&&(r=r.sort((n,c)=>n.sort_order!==null&&c.sort_order!==null?n.sort_order-c.sort_order:0)),r),[])},M=function(e){return!e||e.length===0?[]:[...new Set(e.map(t=>t.subject))].map(t=>({value:t,label:t}))},v=async function(e){const t=a(p).is_guest_mode,r=a(i);t?u(i,"current_grade",e):(await _(s.SETTINGS_UPDATE,{competition_id:a(i).competition_id,grade:e,points:0,school_id:0,friend_id:0}),u(i,"current_grade",e),u(J,"current_grade",e)),console.log(a(i)),z("/competitions/"+r.url+"/home")},h=async function(){await l();const e=a(i).current_grade,t=a(i).competition_id;return await _(s.LESSON_RECOMMENDATION,{competition_id:t,grade:e},{})},H=async function(){await l();const e=a(i).current_grade,t=a(i).competition_id;return await _(s.COMPETITION_ACTIVITIES,{competition_id:t,grade:e},{})},b=async function(e,t){await l();const r=a(i).current_grade,o=a(i).competition_id;return await _(s.LEARNER_LEADERBOARD,{competition_id:o,grade:r,time_type:e,is_school_based:t},{})},A=async function(e){await l();const t=a(i).current_grade,r=a(i).competition_id;return await _(s.FRIENDS,{competition_id:r,grade:t,subject:e},{})},N=async function(e){await l();const t=a(i).current_grade,r=a(i).competition_id;return await _(s.SEARCH_FRIENDS,{competition_id:r,grade:t,username:e},{})},y=async function(){await l();const e=a(i).current_grade,t=a(i).competition_id;return await _(s.USER_LESSONS,{competition_id:t,grade:e},{})},I=async function(e,t,r){if(!await V(e))return;const o=a(W);let n=o!=null&&o.comp_banner_locked?s.ADD_GCLC_VOUCHER:s.ADD_VOUCHER,c={secret_code:e,...(o==null?void 0:o.comp_banner_locked)&&{competition_id:r}};(await _(n,c)).error_code===0&&await B(async()=>{t()})};async function V(e){if(!e)f(await d("code_required"));else if(!F(e))f(await d("code_required_alpha_numeric"));else if(e.length<3)f(await d("code_length"));else return!0;return!1}D=async function(){return[{icon:m.SIDE_NAV_HOME,label:await d("overview"),link:"{competitionHome}/overview",isRequired:!0},{icon:m.SIDE_NAV_LEADERBOARD,label:await d("players"),link:"{competitionHome}/players",isRequired:!0}].filter(e=>e.isRequired)},R=async function(){await l();const e=a(i).current_grade,t=a(i).competition_id;return await _(s.MY_GAMES,{competition_id:t,grade:e,page:1},{})},O=async function(){var n;const e=await g(),t=a(i).current_grade;if(!((n=e==null?void 0:e.data)!=null&&n.grades)||!Array.isArray(e.data.grades))return[{value:"",label:"Select Subject"}];const r=e.data.grades.filter(c=>c.grade===t),o=[...new Set(r.map(c=>c.subject))];return[{value:"",label:"Select Subject"},...o.map(c=>({value:c,label:c}))]}});export{K as __tla,E as a,S as b,I as c,g as d,y as e,A as f,D as g,N as h,O as i,b as j,R as k,T as l,w as m,h as n,H as o,M as p,k as q,v as s};
