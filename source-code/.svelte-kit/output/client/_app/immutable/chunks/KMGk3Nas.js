import{w as T,g as D}from"./CS3uJLGD.js";import{u as q}from"./rUUE80t4.js";import{c as O}from"./CpOe2gu7.js";import{f as P}from"./CaXA0QRm.js";const _="https://devcompetitionapi.knowledgeplatform.com/api/",S="0x4AAAAAAATTI8DjOR9nUgOF",U="993486033665-pvkgktsljun2jmjapsm1kmcpa252j5ef.apps.googleusercontent.com",x="https://qa--kplmsdev.netlify.app/public-login?isBonzo=1&isGlobalGreenGuardians=1",z="https://qa--kplmsdev.netlify.app/",F="localhost:5173",G=_,k=T(new Map),E=new Set,B=2*60*1e3;function I(n){return n&&Date.now()-n.timestamp<B}function j(n,t,i){setTimeout(async()=>{await O(P,"isUILoaded"),window.dispatchEvent(new CustomEvent("apiError",{detail:{message:n,status:t,retryCallback:i}}))},5)}async function J(n,t={},i={}){const{definitionOverrides:d={},allowFailing:p=!1,headers:A={},...b}=i,o={...n,...d},{method:w,endpoint:u,cache:h,secure:$,contentType:C="application/json",loader:g}=o,v=`${u}:${JSON.stringify(t)}`;if(L(o,t),h){let s;if(k.subscribe(r=>{s=r.get(v)})(),s&&I(s))return s.data}g&&window.dispatchEvent(new CustomEvent("loaderStart",{detail:{apiDefinition:o,params:t}}));const m=new AbortController;E.add(m);let a;const y=async()=>{try{const s=`${o.baseURL||G}${u}`,r={...A};if($){const e=M();if(e)r.Authorization=`Bearer ${e}`;else throw{message:"Authentication token is missing",status:401}}let f;if(C==="multipart/form-data"){const e=new FormData;for(const l in t)e.append(l,t[l]);f=e}else r["Content-Type"]="application/json",f=w!=="GET"?JSON.stringify(t):void 0;const c=await fetch(s,{method:w,headers:r,body:f,signal:m.signal,...b});if(!c.ok){const e={status:c.status,message:`${u} request failed with status ${c.status} ${c.statusText}`};if(p)return Promise.reject(e);throw e}if(a=await c.json(),a&&a.error_code&&a.error_code!==0){const e=o==null?void 0:o.errorCodes[a.error_code];e?window.dispatchEvent(new CustomEvent("showErrorToast",{detail:{message:e}})):console.error(a.error_code+" error code is not defined")}h&&k.update(e=>{if(e.size>=20){const l=e.keys().next().value;e.delete(l)}return e.set(v,{data:a,timestamp:Date.now()}),e})}catch(s){return p?Promise.reject(s):new Promise(r=>{j(s.message,s.status||"Unknown",()=>{r(y())})})}finally{E.delete(m),g&&window.dispatchEvent(new CustomEvent("loaderEnd",{detail:{apiDefinition:o,params:t}}))}return a};return y()}function L(n,t){const{requiredParams:i}=n;if(!i)return!0;const d=i.filter(p=>!(p in t));return d.length>0&&j(`Missing required parameters: ${d.join(", ")}`,"400"),!0}function M(){return D(q).auth_token}export{S as P,F as a,U as b,x as c,z as d,J as r};
